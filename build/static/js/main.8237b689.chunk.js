(this["webpackJsonpearthmile-frontend"]=this["webpackJsonpearthmile-frontend"]||[]).push([[0],{118:function(e,t,r){},119:function(e,t,r){"use strict";r.r(t);var n=r(3),a=r(0),c=r.n(a),o=r(10),s=r.n(o),i=r(168),l=r(155);var u=r(16),j=r.n(u),d=r(27),h="http://localhost:8000";function b(e){return p.apply(this,arguments)}function p(){return(p=Object(d.a)(j.a.mark((function e(t){var r,n,a;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={method:"GET",headers:{"Content-Type":"application/json"},credentials:"include"},e.prev=1,t({type:"REQUEST_LOGIN"}),e.next=5,fetch("".concat(h,"/users/google/check"),r);case 5:return n=e.sent,e.next=8,n.json();case 8:if(!(a=e.sent).user){e.next=15;break}return t({type:"LOGIN_SUCCESS",payload:a.user}),localStorage.setItem("currentUser",JSON.stringify(a.user)),e.abrupt("return",a);case 15:t({type:"LOGIN_ERROR",error:"Error Ocurred Try again!"});case 16:return e.abrupt("return");case 19:e.prev=19,e.t0=e.catch(1),t({type:"LOGIN_ERROR",error:"Error Ocurred Try again!"});case 22:case"end":return e.stop()}}),e,null,[[1,19]])})))).apply(this,arguments)}function O(){return(O=Object(d.a)(j.a.mark((function e(t){return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t({type:"LOGOUT"}),localStorage.removeItem("currentUser"),e.next=4,fetch("".concat(h,"/users/logout"));case 4:e.sent;case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var f=r(15),g=r(11),x={user:localStorage.getItem("currentUser")?JSON.parse(localStorage.getItem("currentUser")):"",loading:!1,errorMessage:null},m=function(e,t){switch(t.type){case"REQUEST_LOGIN":return Object(g.a)(Object(g.a)({},e),{},{loading:!0});case"LOGIN_SUCCESS":return Object(g.a)(Object(g.a)({},e),{},{user:t.payload,loading:!1});case"LOGOUT":return Object(g.a)(Object(g.a)({},e),{},{user:""});case"LOGIN_ERROR":return Object(g.a)(Object(g.a)({},e),{},{loading:!1,errorMessage:t.error});default:throw new Error("Unhandled action type: ".concat(t.type))}},v=c.a.createContext(),y=c.a.createContext();function w(){var e=c.a.useContext(v);if(void 0===e)throw new Error("useAuthState must be used within a AuthProvider");return e}function E(){var e=c.a.useContext(y);if(void 0===e)throw new Error("useAuthDispatch must be used within a AuthProvider");return e}var C=function(e){var t=e.children,r=Object(a.useReducer)(m,x),c=Object(f.a)(r,2),o=c[0],s=c[1];return Object(n.jsx)(v.Provider,{value:o,children:Object(n.jsx)(y.Provider,{value:s,children:t})})};var S=r(51),k=r.n(S),N=r(159),P=r(172),L=r(160),M=r(173),R=r(161),U=r(162),I=r(174),_=r(120),G=r(73),T=r.n(G),A=(r(114),r(19)),B=r.n(A),z=r(170),H=r(166),J=r(165),W=r(164),D=r(74),Q=r(75),F=r(167),V=B.a.icon({iconUrl:D.a,iconSize:[28,40],iconAnchor:[14,20],shadowUrl:Q.a});var Y=[{path:"/login",component:function(){return Object(n.jsx)("div",{children:Object(n.jsx)(l.a,{style:{marginTop:"20%"},children:Object(n.jsxs)("center",{children:[Object(n.jsx)("h1",{children:"Login"}),Object(n.jsx)(i.a,{variant:"contained",color:"primary",onClick:function(){window.location.href="http://localhost:8000/users/login/google"},children:"Google Login"})]})})})},isPrivate:!1},{path:"/earthMileMap",component:function(e){var t=Object(a.useState)(""),r=Object(f.a)(t,2),o=r[0],s=r[1],u=Object(a.useState)(null),h=Object(f.a)(u,2),b=h[0],p=h[1],O=Object(a.useState)({lat:"",lng:""}),g=Object(f.a)(O,2),x=g[0],m=g[1],v=Object(a.useState)(!1),y=Object(f.a)(v,2),w=(y[0],y[1]),E=Object(a.useState)([]),C=Object(f.a)(E,2),S=C[0],G=C[1],A=c.a.useState(!1),B=Object(f.a)(A,2),D=B[0],Q=B[1],Y=Object(a.useState)(""),Z=Object(f.a)(Y,2),q=Z[0],K=Z[1],X=Object(a.useState)(""),$=Object(f.a)(X,2),ee=$[0],te=$[1],re=Object(a.useState)(""),ne=Object(f.a)(re,2),ae=(ne[0],ne[1]),ce={fillColor:"red"},oe={fillColor:"blue"},se={fillColor:"green"},ie=Object(a.useRef)(null);return Object(a.useEffect)((function(){navigator.geolocation.getCurrentPosition(function(){var e=Object(d.a)(j.a.mark((function e(t){return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:p(t.coords),m({lat:t.coords.latitude,lng:t.coords.longitude});case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),(function(e){console.log(e),alert("could not get your location")}),{timeout:5e3,enableHighAccuracy:!0})}),[]),Object(a.useEffect)((function(){function e(){return(e=Object(d.a)(j.a.mark((function e(){var t;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,k.a.get("http://localhost:8000/users/getEarthMile");case 2:t=e.sent,console.log(t),t.data.success?s(t.data.earth_mile_id):ae("Error fetching earth miles");case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[o]),Object(a.useEffect)((function(){null!=b&&function(){var e=Object(d.a)(j.a.mark((function e(){var t,r,n;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=b.latitude,r=b.longitude,e.next=3,k.a.get("http://localhost:8000/earth-miles?coordinates=".concat(r,",").concat(t));case 3:n=e.sent,console.log(n),n.data.success?G(n.data.earth_miles):ae("Error fetching earth miles");case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()()}),[b]),Object(n.jsxs)(l.a,{children:[Object(n.jsx)("center",{children:Object(n.jsx)("h1",{children:"Earth Miles Around you"})}),null!=b?Object(n.jsxs)("div",{children:[Object(n.jsxs)(N.a,{center:{lat:b.latitude,lng:b.longitude},zoom:13,scrollWheelZoom:!0,style:{width:"100%",height:"80vh"},children:[Object(n.jsx)(P.a,{attribution:'&copy <a href="http://osm.org/copyright">OpenStreetMap</a> contributors',url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),Object(n.jsxs)(L.a,{children:[S.map((function(e){return Object(n.jsx)(M.a,{center:[e.location[1],e.location[0]],pathOptions:oe,radius:1609,children:Object(n.jsx)(R.a,{children:Object(n.jsx)(l.a,{children:Object(n.jsxs)("center",{children:[Object(n.jsxs)(_.a,{variant:"overline",display:"block",gutterBottom:!0,children:["Users: ",Object(n.jsx)("b",{children:e.users.length})]}),Object(n.jsx)("br",{}),Object(n.jsxs)(_.a,{variant:"overline",display:"block",gutterBottom:!0,children:["Posts: ",Object(n.jsx)("b",{children:e.posts.length})]}),Object(n.jsx)("br",{}),Object(n.jsxs)(_.a,{variant:"overline",display:"block",gutterBottom:!0,children:["Created",Object(n.jsxs)("b",{children:[" ",Object(n.jsx)(T.a,{fromNow:!0,date:e.createdAt})]})]}),Object(n.jsx)(i.a,{variant:"contained",color:"primary",onClick:function(){window.location.href="http://localhost:8000/users/login/google"},children:"View"})]})})})})})),Object(n.jsx)(U.a,{position:{lat:b.latitude,lng:b.longitude},draggable:!1,title:"Your location",icon:V}),""===o?Object(n.jsx)(I.a,{children:function(e){return e.on("mouseup",(function(t){e.dragging.enable(),e.removeEventListener("mousemove")})),Object(n.jsxs)("div",{children:[Object(n.jsx)(M.a,{center:{lat:b.latitude,lng:b.longitude},pathOptions:se,radius:1609}),Object(n.jsx)(M.a,{center:[x.lat,x.lng],pathOptions:ce,radius:1300,ref:ie,eventHandlers:{mousedown:function(){e.dragging.disable(),e.on("mousemove",(function(e){m({lat:e.latlng.lat,lng:e.latlng.lng})}))}}})]})}}):""]}),""===o?Object(n.jsx)(i.a,{style:{float:"right",zIndex:"999",margin:"5px",position:"relative"},variant:"contained",color:"primary",onClick:function(){w(!0),Q(!0)},disabled:!!D,children:"Click to create earth mile"}):""]}),Object(n.jsxs)(z.a,{open:D,onClose:function(){return Q(!1)},"aria-labelledby":"form-dialog-title",children:[Object(n.jsx)(W.a,{id:"form-dialog-title",children:"Earth Mile Details"}),Object(n.jsxs)(J.a,{children:[Object(n.jsx)(F.a,{autoFocus:!0,margin:"dense",id:"name",label:"Enter Project Name",type:"text",value:q,onChange:function(e){K(e.target.value)},fullWidth:!0}),Object(n.jsx)(F.a,{margin:"dense",id:"address",label:"Enter Address",type:"text",value:ee,onChange:function(e){te(e.target.value)},fullWidth:!0})]}),Object(n.jsxs)(H.a,{children:[Object(n.jsx)(i.a,{onClick:function(){Q(!1)},color:"primary",children:"Cancel"}),Object(n.jsx)(i.a,{onClick:Object(d.a)(j.a.mark((function e(){var t,r;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(""!==q){e.next=3;break}return alert("Project Name cannot be empty"),e.abrupt("return");case 3:if(""!==ee){e.next=6;break}return alert("Earth mile address cannot be empty"),e.abrupt("return");case 6:return t={coordinates:"".concat(x.lng,",").concat(x.lat),address:ee,name:q},e.prev=7,e.next=10,k.a.post("http://localhost:8000/earth-miles/create",t);case 10:r=e.sent,console.log(r),r.data.success?alert("Earth Mile created successfully"):alert("Earth Mile creation failed ".concat(r.data.message)),w(!1),Q(!1),e.next=20;break;case 17:e.prev=17,e.t0=e.catch(7),alert("Error Occured!");case 20:case"end":return e.stop()}}),e,null,[[7,17]])}))),color:"primary",children:"Confirm"})]})]})]}):""]})},isPrivate:!1},{path:"/",component:function(e){var t=w().user,r=E();return Object(a.useEffect)((function(){(console.log(t),""===t)&&function(){var t=Object(d.a)(j.a.mark((function t(){return j.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,b(r);case 2:t.sent.user||e.history.push("/login");case 4:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}()()}),[t,r,e]),Object(a.useEffect)((function(){t.earth_mile_id})),Object(n.jsx)("div",{children:"Hellow World"})},isPrivate:!1}],Z=r(22),q=r(12),K=function(e){var t=e.component,r=e.path,a=e.isPrivate,c=Object(Z.a)(e,["component","path","isPrivate"]),o=w();return console.log(o),Object(n.jsx)(q.b,Object(g.a)({path:r,render:function(e){return a&&Boolean(""===o.user)?Object(n.jsx)(q.a,{to:{pathname:"/login"}}):Object(n.jsx)(t,Object(g.a)({},e))}},c))},X=r(34),$=(r(118),r(171));function ee(){var e=Object(a.useState)(!1),t=Object(f.a)(e,2),r=t[0],c=t[1],o=w().user,s=E();return Object(n.jsx)("div",{children:Object(n.jsxs)("div",{className:r?"topnav responsive":"topnav",id:"myTopnav",children:[Object(n.jsx)(X.b,{exact:!0,to:"/",className:"a",activeClassName:"active",children:"Home"}),Object(n.jsx)(X.b,{exact:!0,to:"/earthMileMap",className:"a",activeClassName:"active",children:"Map"}),Object(n.jsx)(X.b,{exact:!0,to:"/profile",className:"a",activeClassName:"active",children:"Profile"}),""!==o?Object(n.jsx)($.a,{alt:"Remy Sharp",src:o.image}):"",""!==o?Object(n.jsx)(i.a,{className:"icon",onClick:function(){return function(e){return O.apply(this,arguments)}(s)},children:"Logout"}):"",""===o?Object(n.jsx)(X.b,{exact:!0,to:"/login",className:"a",activeClassName:"active",children:"Login"}):"",Object(n.jsx)(i.a,{className:"icon",onClick:function(){return c(!r)}})]})})}s.a.render(Object(n.jsx)(c.a.StrictMode,{children:Object(n.jsx)(C,{children:Object(n.jsxs)(X.a,{children:[Object(n.jsx)(ee,{}),Object(n.jsx)(q.d,{children:Y.map((function(e){return Object(n.jsx)(K,{path:e.path,component:e.component,isPrivate:e.isPrivate},e.path)}))})]})})}),document.getElementById("root"))}},[[119,1,2]]]);
//# sourceMappingURL=main.8237b689.chunk.js.map